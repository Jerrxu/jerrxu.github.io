<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link href="css/style.css" rel="stylesheet">
</head>


<body>
<header>
   <h2>JShell 1.1</h2>
   <h4>by <a href="window.open(JURL)">Jerry X</a> & <a href="https://github.com/rorico">Daniel C</a><br>Inspired by <a href="http://uni.xkcd.com/">uni.xkcd.com</a></h4>
</header>

<div class="parent" id="main">
	<div id="form">
		<text id="list"></text>
		<!-- need the <br> to move the input span to the end of the sentence for some reason -->
		guest@jerrxu:/$ <span id="input" autofocus contenteditable="true" spellcheck="false"></span><br>
	</div>
</div>

<footer>
	<text>It's been </text><text id="p1"></text><text> since I worked on this</text>
</footer>

<script>
var last = 1494548787;			// alert("done");
var s = m = h = d = w = 0;		// seconds, minutes, hours, days, weeks
var str;

$(document).ready(function(){
	$(startup());
	function startup() {
		var t = new Date().getTime().toString().substr(0, 10) - last;
		w = Math.floor(t/604800);
		t = t%604800;
		d = Math.floor(t/86400);
		t = t%86400;
		h = Math.floor(t/3600);
		t = t%3600;
		m = Math.floor(t/60);
		s = t = t%60;
		count();
		setInterval(count,1000);
		$('#input').focus();

		new Folder("Daniel Chen", currentFolder);
		new Folder("Jerry Xu", currentFolder);
	}

	function count() {
		s++;
		if ( s >= 60 ){ s = 0; m++;
			if ( m == 60 ){ m = 0; h++;
				if ( h == 24 ){ h = 0; d++;
					if ( d == 7 ){ d = 0; w++;
		}}}}
		str = "";
		concatenate(s, " second");
		if(s!=0){
			str = " and " + str;
		}
		concatenate(m, " minute");
		concatenate(h, " hour");
		concatenate(d, " day");
		concatenate(w, " week");
		document.getElementById("p1").innerHTML = str;	
	}

	function concatenate(t, string) {
		if ( t == 1 ){
			str = t + string + " " + str;
		} else if ( t > 1 ){
			str = t + string + "s " + str;
		}
	}
	
	function printHelp() {
		// TODO: doesn't work :(
		// println("Valid commands:");
		// for (var str in validCommands) {
		// 	println(str);
		// }
	}

	function Folder(name, parent) {
		this.name = name;
		this.parent = parent;
		if (parent) {
			parent.children[name] = this;
			this.fullPath = parent.fullPath + "/" + name;
		} else {
			this.fullPath = "/" + name;
		}
		this.children = {};
	}

	function File(name, parent) {
		this.name = name;
		this.parent = parent;
		if (parent) {
			parent.children[name] = this;
			this.fullPath = parent.fullPath + "/" + name;
		} else {
			this.fullPath = "/" + name;
		}
	}

	function print(str) {
		$('#list').append(str);
	}

	function println(str) {
		print(str + "<br>")
	}

	var fileRoot = new Folder("jerrxu");
	var currentFolder = fileRoot;
	var validCommands = ["cat", "resume", "help", "mkdir", "rm", "cd", "ls", "pwd"];

	$('#input').keypress(function(event){
		var keycode = (event.keyCode ? event.keyCode : event.which);
		if(keycode == '13'){
			var ent = $("#input").html();
			println("guest@jerrxu:/$ " + ent);
			var args = ent.split(" ");
			
			switch(args[0]){
				case "": // empty command, newline 
					break;
				case "cat":
					println("You're a kitty!");
					break;
				case "resume":
					println('Click <a href="resume.docx">here</a> to see my resume.');
					break;
				case "help":
					//printHelp();
					println("You're on your own for now :)");
					break;
				case "mkdir":
					if (args[1] == ".." || args[1] == ".") {
						println("mkdir: cannot create folder \'' + args[1] + '\': File exists'");
					}
					new Folder(args[1], currentFolder);
					break;
				case "rm":
					var entry = currentFolder.children[args[1]];
					if (entry) {
						delete currentFolder.children[args[1]];
					} else {
						println('rm: cannot remove \'' + args[1] + '\': No such file or folder');
					}
					break;
				case "cd":
					if (args[1] == "..") {
						if (currentFolder.parent) {
							currentFolder = currentFolder.parent;
						}
						break;
					}
					var folder = currentFolder.children[args[1]];
					if (folder) {
						currentFolder = folder;
					} else {
						println('cd: cannot find \'' + args[1] + '\': No such file or folder');
					}
					break;
				case "ls":
					for (var file in currentFolder.children) {
						println("&nbsp;" + file);
					}
					break;
				case "pwd":
					println(currentFolder.fullPath);
					break;
				default:	//invalid command
					println('Unrecognized command. Type "help" for assistance.');
			}

			$("#input").empty("");		// clears textbox
			$("html, body").animate({ scrollTop: $(document).height() }, "slow");
			$('#input').focus();
		event.stopPropagation();
		event.preventDefault();
		}
	});
});
</script>
</body>
</html>